function createViewVideo(o,e,t=null){var n="ontouchstart"in window||navigator.msMaxTouchPoints,r=document.querySelector(".view-video-template").content.cloneNode(!0);const c=r.querySelector(".view-root"),i=c.querySelector(".video"),a=(i.src=o,c.querySelector(".download"));a.href=o,a.download=e.name;var l=c.querySelector(".edit-link"),s=new URL(window.location.href),s=s.origin+s.pathname;l.href=s+"?attachment="+o;const d=c.querySelector(".censure");function u(){d.querySelector(".fa-eye").classList.toggle("hidden"),d.querySelector(".fa-eye-slash").classList.toggle("hidden"),i.style.filter=i.style.filter?"":"blur(50px)"}!0===e.censure?(u(),d.onclick=u):d.classList.add("hidden");const m=c.querySelector(".description");l=c.querySelector(".datetime-created");const v=c.querySelector(".fps"),h=c.querySelector(".duration"),f=c.querySelector(".burger-list"),p=c.querySelector(".parameters"),y=c.querySelector(".close-parameters-view"),w=document.querySelector(".modal-view-video-suggest");s=c.querySelector(".suggest-button");function S(e){var t=c.querySelector(".open-burger-button"),e=e.target;f.contains(e)||t.contains(e)||(f.classList.add("hidden"),document.removeEventListener("click",S))}function g(e){var t=c.querySelector(".open-parameters-view"),e=e.target;p.contains(e)||t.contains(e)||y.click()}function q(e){return Math.floor(e/60)+":"+Math.floor(e%60).toString().padStart(2,"0")}return w&&s.parentElement.classList.remove("hidden"),m.textContent=e.name,l.textContent=formatDateTime(e.created),c.querySelector(".repost-button").onclick=function(){var e=o,t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),t.setSelectionRange(0,t.value.length),document.execCommand("copy"),document.body.removeChild(t)},s.onclick=function(){var e;w&&((e=w.content.cloneNode(!0)).querySelectorAll("a").forEach(e=>{e.href+=o}),document.body.appendChild(e))},c.querySelector(".open-video-modal-button").onclick=function(){createModalVideo(o,e,t)},c.querySelector(".copy-description-button").onclick=function(){var e=m.textContent,t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),t.setSelectionRange(0,t.value.length),document.execCommand("copy"),document.body.removeChild(t)},c.querySelector(".rename-button").onclick=function(){openRenameNoticeModal(o,t).then(e=>{m.textContent=e.newFileName;var t=createStaticSrc(e.srcFilePath,e.newFileName);o=t,i.src=t,a.href=t,a.download=e.newFileName}).catch(e=>{})},c.querySelector(".delete-button").onclick=function(){openDeleteNoticeModal(o,t).then(e=>{!0===e&&c.remove()}).catch(e=>{console.error("Error:",e)})},c.querySelector(".open-burger-button").onclick=function(){f.classList.remove("hidden"),setTimeout(()=>{document.addEventListener("click",S)},100)},c.querySelector(".open-parameters-view").onclick=function(){p.classList.remove("hidden"),p.classList.add("block"),setTimeout(()=>{document.addEventListener("click",g)},100)},y.onclick=function(){p.classList.remove("block"),p.classList.add("hidden"),document.removeEventListener("click",g)},n?c.querySelector(".touchscreen-play").addEventListener("click",function(){i.paused?(i.play(),this.classList.add("opacity-0")):(i.pause(),this.classList.remove("opacity-0"))}):(i.addEventListener("mouseover",function(){h.classList.remove("opacity-0"),h.classList.add("opacity-100"),i.play().catch(e=>{})}),i.addEventListener("mouseout",function(){h.classList.remove("opacity-100"),h.classList.add("opacity-0"),i.pause()})),i.addEventListener("loadedmetadata",function(){i.pause(),i.muted=!0;var e,t=q(i.duration);h.textContent="0:00/"+t,i.webkitDecodedFrameCount&&i.webkitDroppedFrameCount?(t=i.webkitDecodedFrameCount/i.duration,e=i.webkitDroppedFrameCount/i.duration,v.textContent=`Decoded FPS: ${t.toFixed(2)}, Dropped FPS: `+e.toFixed(2)):console.log("Video FPS calculations are not supported")}),i.addEventListener("timeupdate",function(){var e=q(i.currentTime),t=q(i.duration);h.textContent=e+"/"+t}),r}function createViewImage(o,e,t=null){var n=document.querySelector(".view-image-template").content.cloneNode(!0);const r=n.querySelector(".view-root"),c=r.querySelector(".burger-list"),i=document.querySelector(".modal-view-image-suggest");var a=r.querySelector(".suggest-button");i&&a.parentElement.classList.remove("hidden");const l=r.querySelector(".image"),s=(l.src=o,r.querySelector(".censure"));function d(){s.querySelector(".fa-eye").classList.toggle("hidden"),s.querySelector(".fa-eye-slash").classList.toggle("hidden"),l.style.filter=l.style.filter?"":"blur(50px)"}!0===e.censure?(d(),s.onclick=d):s.classList.add("hidden");const u=r.querySelector(".download");u.href=o,u.download=e.name;var m=r.querySelector(".edit-link"),v=new URL(window.location.href),v=v.origin+v.pathname;m.href=v+"?attachment="+o;const h=r.querySelector(".description");m=r.querySelector(".datetime-created");function f(e){var t=r.querySelector(".open-parameters-view"),o=r.querySelector(".parameters"),e=e.target;o.contains(e)||t.contains(e)||r.querySelector(".close-parameters-view").click()}function p(e){var t=r.querySelector(".open-burger-button"),e=e.target;c.contains(e)||t.contains(e)||(c.classList.add("hidden"),document.removeEventListener("click",p))}return h.textContent=e.name,m.textContent=formatDateTime(e.created),r.querySelector(".repost-button").onclick=function(){var e=o,t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),t.setSelectionRange(0,t.value.length),document.execCommand("copy"),document.body.removeChild(t)},r.querySelector(".open-image-modal-button").onclick=function(){createModalImage(o,e,t)},r.querySelector(".copy-description-button").onclick=function(){var e=h.textContent,t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),t.setSelectionRange(0,t.value.length),document.execCommand("copy"),document.body.removeChild(t)},r.querySelector(".rename-button").onclick=function(){openRenameNoticeModal(o,t).then(e=>{h.textContent=e.newFileName;var t=createStaticSrc(e.srcFilePath,e.newFileName);o=t,l.src=t,u.href=t,u.download=e.newFileName}).catch(e=>{})},r.querySelector(".delete-button").onclick=function(){openDeleteNoticeModal(o,t).then(e=>{!0===e&&r.remove()}).catch(e=>{console.error("Error:",e)})},a.onclick=function(){var e;i&&((e=i.content.cloneNode(!0)).querySelectorAll("a").forEach(e=>{e.href+=o}),document.body.appendChild(e))},r.querySelector(".open-burger-button").onclick=function(){c.classList.remove("hidden"),setTimeout(()=>{document.addEventListener("click",p)},100)},r.querySelector(".open-parameters-view").onclick=function(){var e=r.querySelector(".parameters");e.classList.remove("hidden"),e.classList.add("block"),setTimeout(()=>{document.addEventListener("click",f)},100)},r.querySelector(".close-parameters-view").onclick=function(){var e=r.querySelector(".parameters");e.classList.remove("block"),e.classList.add("hidden"),document.removeEventListener("click",f)},n}function createViewImageGroup(c,i,t=null){var e="ontouchstart"in window||navigator.msMaxTouchPoints,o=document.querySelector(".view-image-group-template").content.cloneNode(!0);const n=o.querySelector(".view-root"),r=n.querySelector(".image");let a=0;function l(){a=(a+1)%c.length,r.src=c[a].fullPath}r.src=c[a].fullPath,n.querySelector(".touchscreen-back-button").addEventListener("click",function(){a=(a-1+c.length)%c.length,r.src=c[a].fullPath}),n.querySelector(".touchscreen-next-button").addEventListener("click",l),e||(r.addEventListener("mouseover",function(){mouseIntervalId=setInterval(l,100)}),r.addEventListener("mouseout",function(){clearInterval(mouseIntervalId)}));const s=n.querySelector(".censure");function d(){s.querySelector(".fa-eye").classList.toggle("hidden"),s.querySelector(".fa-eye-slash").classList.toggle("hidden"),r.style.filter=r.style.filter?"":"blur(50px)"}!0===i.censure?(d(),s.onclick=d):s.classList.add("hidden"),n.querySelectorAll(".download-archive").forEach(r=>{r.addEventListener("click",()=>{r.innerHTML='<i style="font-size: 1.2rem;width:20px;height:20px;text-align: center;" class="fa-regular fa-file-zipper"></i>';const o=new JSZip,n=[];c.forEach(t=>{var e=fetch(t.fullPath).then(e=>e.blob()).then(e=>{o.file(t.name,e)}).catch(e=>console.error("Error fetching file:",e));n.push(e)}),Promise.all(n).then(()=>{o.generateAsync({type:"blob"}).then(e=>{var e=window.URL.createObjectURL(e),t=document.createElement("a");t.href=e,t.download=i.name+".zip",t.click(),window.URL.revokeObjectURL(e),r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="#0D0D0D"><path d="M17.5 12.5V15.8333C17.5 16.2754 17.3244 16.6993 17.0118 17.0118C16.6993 17.3244 16.2754 17.5 15.8333 17.5H4.16667C3.72464 17.5 3.30072 17.3244 2.98816 17.0118C2.67559 16.6993 2.5 16.2754 2.5 15.8333V12.5M5.83333 8.33333L10 12.5M10 12.5L14.1667 8.33333M10 12.5V2.5" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>'}).catch(e=>console.error("Error creating archive:",e))})})});const u=n.querySelector(".description");e=n.querySelector(".datetime-created");function m(e){var t=n.querySelector(".open-parameters-view"),o=n.querySelector(".parameters"),e=e.target;o.contains(e)||t.contains(e)||n.querySelector(".close-parameters-view").click()}return u.textContent=i.name,e.textContent=formatDateTime(i.created),n.querySelector(".repost-button").onclick=function(){var e=c.map(e=>e.fullPath).join(", "),t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),t.setSelectionRange(0,t.value.length),document.execCommand("copy"),document.body.removeChild(t)},n.querySelector(".open-image-modal-button").onclick=function(){createModalImageGroup(c,i,t)},n.querySelector(".copy-description-button").onclick=function(){var e=u.textContent,t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),t.setSelectionRange(0,t.value.length),document.execCommand("copy"),document.body.removeChild(t)},n.querySelectorAll(".delete-all-button").forEach(e=>{e.addEventListener("click",()=>{openDeleteAllFilesNoticeModal(c,t).then(e=>{}).catch(e=>{console.error("Error:",e)})})}),n.querySelector(".open-parameters-view").onclick=function(){var e=n.querySelector(".parameters");e.classList.remove("hidden"),e.classList.add("block"),setTimeout(()=>{document.addEventListener("click",m)},100)},n.querySelector(".close-parameters-view").onclick=function(){var e=n.querySelector(".parameters");e.classList.remove("block"),e.classList.add("hidden"),document.removeEventListener("click",m)},o}function createViewAudio(o,e,t=null){var n=document.querySelector(".view-audio-template").content.cloneNode(!0);const r=n.querySelector(".view-root"),c=r.querySelector(".audio"),i=(c.src=o,r.querySelector(".download")),a=(i.href=o,i.download=e.name,r.querySelector(".description"));var l=r.querySelector(".datetime-created");const s=r.querySelector(".audio-control"),d=r.querySelector(".sound-button"),u=r.querySelector(".current-time"),m=r.querySelector(".duration"),v=r.querySelector(".current-time-slider"),h=r.querySelector(".audio-wave");function f(e){var t=r.querySelector(".open-parameters-view"),o=r.querySelector(".parameters"),e=e.target;o.contains(e)||t.contains(e)||r.querySelector(".close-parameters-view").click()}function p(e){const i=20,a=document.createElement("canvas"),t=(a.style.opacity=.5,a.width=h.offsetWidth,a.height=h.offsetHeight-2*i,h.appendChild(a),window.AudioContext=window.AudioContext||window.webkitAudioContext,new AudioContext);const l=(e,t,o,n,r)=>{e.lineWidth=1,e.strokeStyle="#fff",e.fillStyle="#fff",e.beginPath(),o=r?o:-o,o=-Math.abs(o),e.moveTo(t,0),e.lineTo(t,o),e.arc(t+n/2,o,n/2,0,0,r),e.lineTo(t+n,0),e.stroke(),e.fill()};fetch(e).then(e=>e.arrayBuffer()).then(e=>t.decodeAudioData(e)).then(e=>{{var o=(e=>{const t=Math.pow(Math.max(...e),-1);return e.map(e=>e*t)})((e=>{const n=e.getChannelData(0),t=100,r=Math.floor(n.length/t),c=[];for(let e=0;e<t;e++){let t=r*e;let o=0;for(let e=0;e<r;e++)o=o+Math.abs(n[t+e]);c.push(o/r)}return c})(e)),t=window.devicePixelRatio||1,n=(a.width=a.offsetWidth*t,a.height=(a.offsetHeight+2*i)*t,a.getContext("2d")),r=(n.scale(t,t),n.translate(0,a.offsetHeight/2+i),a.offsetWidth/o.length);for(let t=0;t<o.length;t++){var c=r*t;let e=o[t]*a.offsetHeight-i;e<0?e=0:e>a.offsetHeight/2&&(e=e>a.offsetHeight/2),l(n,c,e,r,(t+1)%2)}}})}function y(e){return Math.floor(e/60)+":"+Math.floor(e%60).toString().padStart(2,"0")}return a.textContent=e.name,l.textContent=formatDateTime(e.created),h.addEventListener("click",function(e){var t=this.getBoundingClientRect(),o=this.parentElement.getBoundingClientRect(),e=e.pageX-t.left-(o.left-t.left),o=this.offsetWidth,t=Math.min(e,o)/o*100,e=(v.style.left=t+"%",c.duration),o=e*t/100;c.currentTime=o}),r.querySelector(".repost-button").onclick=function(){var e=o,t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),t.setSelectionRange(0,t.value.length),document.execCommand("copy"),document.body.removeChild(t)},r.querySelector(".rename-button").onclick=function(){openRenameNoticeModal(o,t).then(e=>{a.textContent=e.newFileName;var t=createStaticSrc(e.srcFilePath,e.newFileName);o=t,image.src=t,i.href=t,i.download=e.newFileName}).catch(e=>{})},r.querySelector(".delete-button").onclick=function(){openDeleteNoticeModal(o,t).then(e=>{!0===e&&r.remove()}).catch(e=>{console.error("Error:",e)})},r.querySelector(".open-parameters-view").onclick=function(){var e=r.querySelector(".parameters");e.classList.remove("hidden"),e.classList.add("block"),setTimeout(()=>{document.addEventListener("click",f)},100)},r.querySelector(".close-parameters-view").onclick=function(){var e=r.querySelector(".parameters");e.classList.remove("block"),e.classList.add("hidden"),document.removeEventListener("click",f)},d.addEventListener("click",function(){c.muted=!c.muted;var e=c.muted?'<svg style="scale:1.4;" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" class="h-4"><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-opacity="0.85" stroke-width="1.5" d="m14.667 6-4 4m0-4 4 4M7.333 3.333 4 6H1.333v4H4l3.333 2.667V3.333Z"></path></svg>':'<svg style="scale:1.4;" xmlns="http://www.w3.org/2000/svg" width="16" height="12" viewBox="0 0 16 12" fill="none" class="h-4"><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-opacity="0.85" stroke-width="1.5" d="M10.36 3.64a3.333 3.333 0 0 1 0 4.713m2.353-7.066a6.667 6.667 0 0 1 0 9.426m-5.38-9.38L4 4H1.333v4H4l3.333 2.667V1.333Z"></path></svg>';d.innerHTML=e}),s.addEventListener("click",function(){c.paused?c.play():c.pause();var e=c.paused?'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="#fff"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4.167 2.5 15.832 10 4.166 17.5v-15Z"></path></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="#fff"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7.833 3.333H4.5v13.334h3.333V3.333ZM15.5 3.333h-3.333v13.334H15.5V3.333Z"></path></svg>';s.innerHTML=e}),c.addEventListener("ended",function(){s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="#fff"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4.167 2.5 15.832 10 4.166 17.5v-15Z"></path></svg>'}),c.addEventListener("loadedmetadata",function(){c.pause(),c.muted=!1;var e=y(c.duration);u.textContent="0:00",m.textContent=""+e,p(c.src)}),c.addEventListener("timeupdate",function(){var e=y(c.currentTime),t=y(c.duration),o=c.currentTime/c.duration*100;u.textContent=""+e,m.textContent=""+t,v.style.left=o+"%"}),n}function createViewFilter(){"ontouchstart"in window||navigator.msMaxTouchPoints;var e=document.querySelector(".view-filter-template").content.cloneNode(!0);e.querySelector(".view-root");const o=e.querySelector(".view-filter-all"),n=e.querySelector(".view-filter-video"),r=e.querySelector(".view-filter-image"),c=e.querySelector(".view-filter-images-group"),i=e.querySelector(".view-filter-audio");e.querySelector(".view-filter-favorites");function t(e,t){userFileFormats=t,reloadViewContent(moduleName,t),[o,n,r,c,i].forEach(e=>{e.classList.remove("opacity-100","border-b"),e.classList.add("opacity-60")}),e.classList.remove("opacity-60"),e.classList.add("opacity-100","border-b")}return userFileFormats.includes("video")&&n.classList.remove("hidden"),userFileFormats.includes("image")&&r.classList.remove("hidden"),userFileFormats.includes("group")&&c.classList.remove("hidden"),userFileFormats.includes("audio")&&i.classList.remove("hidden"),o.onclick=function(){t(this,pageFileFormats)},n.onclick=function(){t(this,["video"])},r.onclick=function(){t(this,["image"])},c.onclick=function(){t(this,["group"])},i.onclick=function(){t(this,["audio"])},e}function createViewLoad(e){"ontouchstart"in window||navigator.msMaxTouchPoints;var t=document.querySelector(".view-load-template").content.cloneNode(!0);const o=t.querySelector(".view-root");var n=e.request_id,n=(o.dataset.requestId=n,o.querySelector(".description")),r=o.querySelector(".datetime-created");function c(e){var t=o.querySelector(".open-parameters-view"),e=e.target;parametersView.contains(e)||t.contains(e)||closeParametersView.click()}return n.textContent=e.name,r.textContent=formatDateTime(e.created),o.querySelector(".hidden-button ").onclick=function(){o.classList.add("hidden")},o.querySelector(".open-parameters-view").onclick=function(){var e=o.querySelector(".parameters");e.classList.remove("hidden"),e.classList.add("block"),setTimeout(()=>{document.addEventListener("click",c)},100)},o.querySelector(".close-parameters-view").onclick=function(){var e=o.querySelector(".parameters");e.classList.remove("block"),e.classList.add("hidden"),document.removeEventListener("click",c)},t}function updateViewLoad(o){const n=document.querySelector(".view-content");var e=n.querySelectorAll(".view-load");const r=Array.from(e).map(e=>e.dataset.requestId);o.forEach(e=>{var t=e.request_id;r.includes(t)||(t=createViewLoad(e),n.insertBefore(t,n.firstChild))}),e.forEach(e=>{const t=e.dataset.requestId;o.some(e=>e.request_id===t)||e.remove()})}function removeViewLoadUniq(o){var e=document.querySelector(".view-content").querySelectorAll(".view-load");Array.isArray(o)&&o.some?e.forEach(e=>{const t=e.dataset.requestId;o.some(e=>e.request_id===t)||e.remove()}):console.error("Response is not an array or does not have the some function:",o)}
