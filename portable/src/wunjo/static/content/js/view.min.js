function getFileFormat(e){let t="other";switch(e.split(".")[e.split(".").length-1]){case"jpg":case"jpeg":case"png":case"gif":t="image";break;case"mp4":case"mov":case"avi":t="video";break;case"mp3":case"wav":case"ogg":t="audio"}return t}function getFileMetadataDate(e){var t,a;return e?(t=(e=new Date(1e3*e)).getFullYear(),a=e.getMonth(),{day:e.getDate(),month:a,year:t}):{day:null,month:null,year:null}}let viewSystem=userFileTree;function initViewContent(e=null){(e.includes("group")?initViewContentGroup:initViewContentUniq)(e)}function initViewContentGroup(e=null){const o=window.location.origin;var t=JSON.parse(JSON.stringify(viewSystem));t.forEach(n=>{n.isDirectory?n.child.forEach(a=>{a.isDirectory?a.child.forEach((e,t)=>{e.isDirectory||(e.fullPath=`${o}/media/content/${userContentId}/${moduleName}/${n.name}/${a.name}/`+e.name,e.fileFormat=getFileFormat(e.name),e.index=t,e.useFile=!0)}):(a.fullPath=`${o}/media/content/${userContentId}/${moduleName}/${n.name}/`+a.name,a.fileFormat=getFileFormat(a.name),a.useFile=!1)}):(n.fullPath=`${o}/media/content/${userContentId}/${moduleName}/`+n.name,n.fileFormat=null,n.useFile=null)}),setupViewContentGroup(t,e)}function setupViewContentGroup(e,t=null){var a=new Date,n=document.querySelector(".user-calendar-date"),o=parseInt(n.getAttribute("data-year-from"))||a.getFullYear(),i=parseInt(n.getAttribute("data-month-from"))||a.getMonth(),r=parseInt(n.getAttribute("data-day-from"))||a.getDate(),l=parseInt(n.getAttribute("data-year-to"))||a.getFullYear(),d=parseInt(n.getAttribute("data-month-to"))||a.getMonth(),n=parseInt(n.getAttribute("data-day-to"))||a.getDate(),u=(new Date(o,i,r),new Date(l,d,n),document.querySelector(".view-content"));u.querySelectorAll(".view-root").forEach(e=>{e.classList.contains("view-load")||e.remove()});for(const f in e)if(e[f].isDirectory)for(const g in e[f].child)if(e[f].child[g].isDirectory){var c=e[f].child[g],s=getFileMetadataDate(c.created),m=(s.day&&s.month&&s.year,new Date(s.year,s.month,s.day),[]);for(const w in e[f].child[g].child){var h=c.child[g].fileFormat;!0===c.child[g].useFile&&"image"===h&&m.push(e[f].child[g].child[w])}m.sort((e,t)=>e.name.localeCompare(t.name)),0<m.length&&(modalContent=createViewImageGroup(m,c,()=>reloadViewContent(moduleName,t)))&&u.appendChild(modalContent)}}function initViewContentUniq(e=null){const a=window.location.origin;var t=JSON.parse(JSON.stringify(viewSystem));t.forEach(t=>{t.isDirectory?t.child.forEach(e=>{e.isDirectory||(e.fullPath=`${a}/media/content/${userContentId}/${moduleName}/${t.name}/`+e.name,e.fileFormat=getFileFormat(e.name),e.useFile=!0)}):(t.fullPath=`${a}/media/content/${userContentId}/${moduleName}/`+t.name,t.fileFormat=null,t.useFile=null)}),setupViewContentUniq(t,e)}function setupViewContentUniq(e,t=null){var a=new Date,n=document.querySelector(".user-calendar-date"),o=parseInt(n.getAttribute("data-year-from"))||a.getFullYear(),i=parseInt(n.getAttribute("data-month-from"))||a.getMonth(),r=parseInt(n.getAttribute("data-day-from"))||a.getDate(),l=parseInt(n.getAttribute("data-year-to"))||a.getFullYear(),d=parseInt(n.getAttribute("data-month-to"))||a.getMonth(),n=parseInt(n.getAttribute("data-day-to"))||a.getDate(),u=new Date(o,i,r),c=new Date(l,d,n),s=document.querySelector(".view-content");s.querySelectorAll(".view-root").forEach(e=>{e.classList.contains("view-load")||e.remove()});for(const w in e)if(e[w].isDirectory)for(const y in e[w].child)if(!e[w].child[y].isDirectory){var m=e[w].child[y],h=getFileMetadataDate(m.created),f=m.fileFormat,g=m.useFile;if(h.day&&h.month&&h.year){h=new Date(h.year,h.month,h.day);if(!(h<u||c<h)&&!0===g){if("video"===f&&t.includes("video"))modalContent=createViewVideo(m.fullPath,m,()=>reloadViewContent(moduleName,t));else if("image"===f&&t.includes("image"))modalContent=createViewImage(m.fullPath,m,()=>reloadViewContent(moduleName,t));else{if("audio"!==f||!t.includes("audio"))continue;modalContent=createViewAudio(m.fullPath,m,()=>reloadViewContent(moduleName,t))}modalContent&&s.appendChild(modalContent)}}}}function reloadViewContent(e,t=null){fetch("/content-reload/"+e,{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{200===e.status?(viewSystem=e.user_file_tree,viewSys=JSON.parse(JSON.stringify(viewSystem)),initViewContent(t)):frontendConsoleLogToBackendPrint(e.message)}).catch(e=>{console.error("Error:",e)})}initViewContent(userFileFormats);
